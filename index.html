<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered MCQ Cleaner & Converter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
            margin-left: 10px;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 20px;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
        .section {
            display: flex;
            flex-direction: column;
        }
        label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        textarea {
            width: 100%;
            height: 400px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        textarea:read-only {
            background: #f7fafc;
        }
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        button {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }
        .btn-ai {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
        }
        .btn-ai:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(240, 147, 251, 0.6);
        }
        .btn-ai:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .btn-convert {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-convert:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        .btn-clear {
            background: white;
            border: 2px solid #e2e8f0;
            color: #4a5568;
        }
        .btn-clear:hover {
            background: #f7fafc;
        }
        .btn-download {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
        }
        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 187, 120, 0.6);
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            background: #ebf4ff;
            border-radius: 8px;
            margin-top: 20px;
        }
        .loading.active {
            display: block;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .info-box {
            background: #ebf4ff;
            border: 1px solid #bee3f8;
            border-left: 4px solid #4299e1;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        .info-box h3 {
            color: #2c5282;
            margin-bottom: 15px;
        }
        .info-box ul {
            margin-left: 20px;
            color: #2d3748;
        }
        .info-box li {
            margin-bottom: 8px;
        }
        .warning-box {
            background: #fffaf0;
            border: 1px solid #fbd38d;
            border-left: 4px solid #ed8936;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .success {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-left: 4px solid #48bb78;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            color: #22543d;
        }
        .error {
            background: #fff5f5;
            border: 1px solid #feb2b2;
            border-left: 4px solid #f56565;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            color: #742a2a;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ AI-Powered MCQ Cleaner & Converter <span class="badge">AI ENABLED</span></h1>
        <p class="subtitle">Paste messy MCQs ‚Üí AI cleans and formats ‚Üí Get perfect CSV</p>

        <div class="grid">
            <div class="section">
                <label for="input">üì• Paste Your Messy MCQs Here</label>
                <textarea id="input" placeholder="Paste ANY messy MCQ text here...

Examples of what AI can handle:
‚Ä¢ Wrong numbering (3, 1, 5, 2, 4)
‚Ä¢ Missing options
‚Ä¢ Poor formatting
‚Ä¢ Extra spaces or line breaks
‚Ä¢ Inconsistent style
‚Ä¢ Mixed formats

Just paste and let AI fix it!"></textarea>
                <div class="buttons">
                    <button class="btn-ai" onclick="cleanWithAI()" id="aiBtn">
                        ‚ú® Clean with AI
                    </button>
                    <button class="btn-clear" onclick="clearAll()">üóëÔ∏è Clear</button>
                </div>
            </div>

            <div class="section">
                <label for="cleaned">üéØ AI-Cleaned MCQs</label>
                <textarea id="cleaned" readonly placeholder="AI-cleaned MCQs will appear here..."></textarea>
                <div class="buttons">
                    <button class="btn-convert" onclick="convertToCSV()" id="convertBtn" style="display: none;">
                        üìä Convert to CSV
                    </button>
                </div>
            </div>
        </div>

        <div class="section" style="margin-top: 20px;" id="csvSection" style="display: none;">
            <label for="output">üì§ CSV Output</label>
            <textarea id="output" readonly placeholder="CSV output will appear here..."></textarea>
            <div class="buttons">
                <button class="btn-download" onclick="downloadCSV()" id="downloadBtn" style="display: none;">
                    üíæ Download CSV File
                </button>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <strong>AI is cleaning your MCQs...</strong>
            <p>This may take 10-30 seconds depending on the number of questions</p>
        </div>

        <div id="message"></div>

        <div class="info-box">
            <h3>üöÄ How to Use This AI-Powered Tool</h3>
            <ul>
                <li><strong>Step 1:</strong> Copy ANY messy MCQ text from your book/PDF</li>
                <li><strong>Step 2:</strong> Paste it in the left box</li>
                <li><strong>Step 3:</strong> Click "Clean with AI" - wait 10-30 seconds</li>
                <li><strong>Step 4:</strong> AI will reformat with proper numbering (1, 2, 3...) and structure</li>
                <li><strong>Step 5:</strong> Click "Convert to CSV"</li>
                <li><strong>Step 6:</strong> Download and use in the MCQ Platform!</li>
            </ul>
        </div>

        <div class="warning-box">
            <strong>‚ö†Ô∏è Note:</strong> AI processing requires internet connection. Each cleaning takes 10-30 seconds. For best results, paste 5-15 MCQs at a time.
        </div>
    </div>

    <script>
        async function cleanWithAI() {
            const input = document.getElementById('input').value;
            const loading = document.getElementById('loading');
            const message = document.getElementById('message');
            const aiBtn = document.getElementById('aiBtn');
            const cleanedTextarea = document.getElementById('cleaned');
            
            if (!input.trim()) {
                showMessage('Please paste your MCQ text first!', 'error');
                return;
            }

            loading.classList.add('active');
            aiBtn.disabled = true;
            message.innerHTML = '';

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 4000,
                        messages: [{
                            role: 'user',
                            content: `You are an MCQ formatting expert. Clean and reformat the following messy MCQ text according to these rules:

1. Number MCQs sequentially starting from 1
2. Each MCQ must have EXACTLY 5 options labeled A, B, C, D, E
3. Format each MCQ as:
   [Number]. [Reference if any]
   [Question text]
   - A. [Option A text]
   - B. [Option B text]  
   - C. [Option C text]
   - D. [Option D text]
   - E. [Option E text]

4. Keep all original question and option text - DO NOT modify medical/technical content
5. Fix numbering, spacing, and formatting issues
6. If options are missing, note it but format what exists
7. Remove extra line breaks and clean up spacing

MESSY MCQ TEXT:
${input}

OUTPUT ONLY THE CLEANED MCQs - NO EXPLANATIONS OR COMMENTS.`
                        }]
                    })
                });

                const data = await response.json();
                
                if (data.content && data.content[0] && data.content[0].text) {
                    const cleanedText = data.content[0].text;
                    cleanedTextarea.value = cleanedText;
                    document.getElementById('convertBtn').style.display = 'block';
                    showMessage('‚úÖ MCQs cleaned successfully by AI! Now click "Convert to CSV"', 'success');
                } else {
                    throw new Error('Invalid response from AI');
                }

            } catch (error) {
                console.error('AI Error:', error);
                showMessage('‚ùå AI cleaning failed. Please try: 1) Check internet connection, 2) Try smaller batch of MCQs, 3) Use manual converter', 'error');
            } finally {
                loading.classList.remove('active');
                aiBtn.disabled = false;
            }
        }

        function convertToCSV() {
            const input = document.getElementById('cleaned').value;
            const output = document.getElementById('output');
            const message = document.getElementById('message');
            const downloadBtn = document.getElementById('downloadBtn');
            const csvSection = document.getElementById('csvSection');
            
            if (!input.trim()) {
                showMessage('No cleaned text to convert!', 'error');
                return;
            }

            try {
                const lines = input.split('\n');
                const mcqs = [];
                let currentMCQ = null;
                let questionText = '';
                let options = [];

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    const mcqMatch = line.match(/^#{0,3}\s*\*{0,2}(\d+)\./);
                    
                    if (mcqMatch) {
                        if (currentMCQ && options.length === 5) {
                            currentMCQ.options = options;
                            mcqs.push(currentMCQ);
                        }
                        
                        const mcqNumber = parseInt(mcqMatch[1]);
                        currentMCQ = { number: mcqNumber, question: '', options: [] };
                        questionText = '';
                        options = [];
                        continue;
                    }

                    if (currentMCQ && !line.match(/^-?\s*[\(\[]?[A-E][\.\)\]]/i) && line.length > 0 && !line.startsWith('#')) {
                        questionText += (questionText ? ' ' : '') + line;
                    }

                    const optionMatch = line.match(/^-?\s*[\(\[]?([A-E])[\.\)\]]\s*(.+)/i);
                    if (optionMatch && currentMCQ) {
                        const optionLetter = optionMatch[1].toUpperCase();
                        const optionText = optionMatch[2].trim();
                        
                        if (!currentMCQ.question && questionText) {
                            currentMCQ.question = questionText.trim();
                        }
                        
                        options.push({ letter: optionLetter, text: optionText });
                    }
                }

                if (currentMCQ && options.length === 5) {
                    currentMCQ.options = options;
                    mcqs.push(currentMCQ);
                }

                if (mcqs.length === 0) {
                    showMessage('No valid MCQs found! Try AI cleaning again.', 'error');
                    return;
                }

                let csv = 'MCQ Number,Stem Number,Question/Option Text\n';
                
                mcqs.forEach(mcq => {
                    const cleanQuestion = mcq.question.replace(/"/g, '""');
                    csv += `${mcq.number},0,"${cleanQuestion}"\n`;
                    
                    mcq.options.forEach((opt, idx) => {
                        const stemNumber = idx + 1;
                        const cleanOption = opt.text.replace(/"/g, '""');
                        csv += `${mcq.number},${stemNumber},"${cleanOption}"\n`;
                    });
                });

                output.value = csv;
                csvSection.style.display = 'block';
                downloadBtn.style.display = 'block';
                showMessage(`‚úÖ Successfully converted ${mcqs.length} MCQ(s) to CSV!`, 'success');

                // Scroll to CSV section
                csvSection.scrollIntoView({ behavior: 'smooth' });

            } catch (err) {
                showMessage('Error: ' + err.message, 'error');
            }
        }

        function downloadCSV() {
            const csv = document.getElementById('output').value;
            if (!csv) {
                showMessage('No CSV to download!', 'error');
                return;
            }

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'ai_cleaned_mcqs.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showMessage('‚úÖ CSV file downloaded successfully!', 'success');
        }

        function clearAll() {
            document.getElementById('input').value = '';
            document.getElementById('cleaned').value = '';
            document.getElementById('output').value = '';
            document.getElementById('message').innerHTML = '';
            document.getElementById('convertBtn').style.display = 'none';
            document.getElementById('downloadBtn').style.display = 'none';
            document.getElementById('csvSection').style.display = 'none';
        }

        function showMessage(text, type) {
            const message = document.getElementById('message');
            message.className = type;
            message.innerHTML = '<strong>' + (type === 'error' ? '‚ùå ' : '‚úÖ ') + '</strong>' + text;
        }
    </script>
</body>
</html>